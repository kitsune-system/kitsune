#!/bin/bash
pidFile=kitsune.pid

function cleanup() {
  echo
  echo 'Terminating Kitsune...'
  rm $pidFile
}

trap cleanup EXIT

while true; do
  echo
  echo "Running Kitsune..."
  echo

  KITSUNE_ON_STARTED='touch ./src/integration.spec.js' KITSUNE_HTTP_PORT=1126 node dist/main.js &

  pid=$(echo $!)
  echo $pid > $pidFile
  wait $pid
done
